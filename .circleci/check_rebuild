#!/bin/bash
# Succeeds if any files matching the rebuild patterns, have changed since the base commit.
set -e

BASE_COMMIT=$1
PATTERNS=${REBUILD_PATTERNS:-.rebuild_patterns}

# If given nothing, then return true to rebuild.
[ -n "$BASE_COMMIT" ] || exit 0

# If there are is no rebuild patterns file, create one from project directory.
if [ ! -f "$PATTERNS" ]; then
  echo "^$(git rev-parse --show-prefix)" > $PATTERNS
fi

if git diff --name-only ${BASE_COMMIT} ${COMMIT_HASH} | grep -q -f $PATTERNS; then
  exit 0
else
  exit 1
fi